TITLE Gabriel Lopes (RA: 22002381) e José Pascoal (RA: 22002728)
.MODEL SMALL
.DATA
    msg1 DB 10, "Digite o primeiro numero: $"
    msg2 DB 10, "Digite o segundo numero: $"
    msg3 DB 10, "Digite a operacao que deseja utilizar: ", 10,"(+) -> soma",10,"(-) -> subtracao", 10, "(*) -> multiplicacao", 10,"(/) -> Divisao",10,10,"Digite aqui -> $"
    msg4 DB 10, "O resultado eh: $"
    msg5 DB 10, "Resto = $"
    msg6 DB 10, "Não eh possivel dividir por 0! $"

.CODE
MAIN PROC

MOV AX,@DATA            ;INICIALIZAÇÃO DO DATA
MOV DS,AX               ;COLOCANDO O ENDERÇO BASE DO SEGMENTO EM DS
MOV AH,09H              ;PREPARA FUNÇÃO INT 21H IMPRIMIR STRING
MOV DX, offset msg3     ;deixando a interface confortável
INT 21H                 ;IMPRIMI STRING msg3
MOV AH, 01              ;LENDO CL - LENDO COMANDO
INT 21h
MOV CL, AL
MOV AH,09               ;PREPARANDO FUNÇÃO IMPRIMIR STRING
LEA DX, msg1            ;APONTA DX PARA O ENDEREÇO DO CONTEÚDO DE msg1
INT 21H                 ;IMPRIME STRING msg1
MOV AH, 01              ;PREPARAÇÃO FUNÇÃO LEITURA
INT 21h                 ;LEITURA DE BL - PRIMEIRO NÚMERO
MOV BL, AL              ;MOVENDO O CONTEÚDO DE AL PARA BL
MOV AH, 09              ;PREPARANDO FUNÇÃO IMPRIMIR STRING
LEA DX, msg2            ;APONTA DX PARA O ENDEREÇO DO CONTEÚDO DE msg2
INT 21H                 ;IMPRIME STRING msg2
MOV AH, 01              ;PREPARAÇÃO FUNÇÃO LEITURA
INT 21h                 ;LEITURA DE BH - SEGUNDO NÚMERO
MOV BH, AL              ;MOVENDO O CONTEÚDO DE AL PARA BH

CALL SOMA               ;CHAMADA DO PROCEDIMENTO 1 (SOMA)
CALL SUBTRACAO          ;CHAMADA DO PROCEDIMENTO 2 (SUBTRACAO)
CALL MULTIPLICACAO      ;CHAMADA DO PROCEDIMENTO 3 (MULTIPLICACAO)
CALL DIVISAO            ;CHAMADA DO PROCEDIMENTO 4 (DIVISAO)

MOV AH,4Ch              ;FUNÇÃO DE RETORNO DA INT 21H
INT 21h

MAIN endp               ;FINALIZAÇÃO DA MAIN

SOMA PROC               ;PROCEDIMENTO 1 (SOMA)
                        ;RESPONSÁVEL EM REALIZAR A SOMA DE DOIS NÚMEROS 

CMP CL,'+'              ;VERIFICAÇÃO DA OPERAÇÃO
JNE NEXT                ;SE FOR IGUAL ELE REALIZA A SOMA, SE NÃO FOR IGUAL ELE PULA PARA NEXT

ADD BL, BH              ;BL = BL+BH
MOV AL, BL              ;AL <- CONTEÚDO DE BL
MOV AH, 0               ;ZERA AH 
AAA                     ;FUNÇÃO ONDE REALIZA A SEPARAÇÃO DOS DÍGITOS DA SOMA
MOV BX,AX               ;CONTEÚDO DE AX -> BX
ADD BH, 30H             ;TRANSFORMA O NÚMERO DECIMAL EM CARACTER
ADD BL, 30H             ;TRANSFORMA O NÚMERO DECIMAL EM CARACTER
MOV AH, 09H             ;PREPARA A FUNÇÃO IMPRIMI STRING INT 21H
LEA DX, msg4            ;FAZ O CONTEÚDO DE DX APONTAR PARA O ENDEREÇO DE ms4
INT 21H                 ;IMPRIMI A STRING ms4
MOV AH, 02H             ;PREPARA FUNÇÃO INT 21H IMPRIMIR CARACTER
MOV DL, BH              ;CONTEÚDO DE BH -> DL
INT 21H                 ;IMPRIMI O CARACTER EM DL
MOV AH, 02H             ;PREPARA FUNÇÃO INT 21H IMPRIMIR CARACTER
MOV DL, BL              ;CONTEÚDO DE BL -> DL
INT 21H                 ;IMPRIMI O CARACTER EM DL

NEXT: 
    RET                 ;RETORNA PARA ONDE FOI FEITO A CHAMADA DO PROCEDIMENTO 1 (SOMA) NA MAIN

SOMA endp               ;FINALIZAÇÃO DO PROCEDIMENTO 1(SOMA)

SUBTRACAO PROC          ;PROCEDIMENTO 2 (SUBTRACAO)
                        ;RESPONSÁVEL EM REALIZAR A SUBTRAÇÃO DE DOIS NÚMEROS 
CMP CL,'-'              ;VERIFICAÇÃO DA OPERAÇÃO
JNE NEXT1               ;SE FOR IGUAL ELE REALIZA A SUBTRAÇÃO, SE NÃO FOR IGUAL ELE PULA PARA NEXT1

AND BL, 0FH             ;TRANSFORMA CARACTER EM DECIMAL
AND BH, 0FH             ;TRANSFORMA CARACTER EM DECIMAL
CMP BH, BL              ;COMPARA O CONTEÚDO DE BH COM O CONTEÚDE DE BL
JBE POSITIVO            ;SE BH FOR MAIOR OU IGUAL QUE BL ELE PULA PARA POSITIVO, SE FOR MENOR ELE CONTINUA
SUB BH, BL              ;BH = BH-BL
OR BH, 30H              ;TRANSFORMA DECIMAL EM CARACTER
OR BL, 30H              ;TRANSFORMA DECIMAL EM CARACTER
MOV AH, 09H             ;FUNCÃO INT 21H IMPRIMIR STRING
LEA DX, msg4            ;FAZ O CONTEÚDO DE DX APONTAR PARA O ENDEREÇO DE ms4
INT 21H                 ;IMPRIMI A STRING msg4
MOV AH, 02H             ;PREPARA FUNÇÃO INT 21H IMPRIMIR CARACTER
MOV DL, '-'             ;COLOCA O CARACTER '-' EM DL
INT 21H                 ;IMPRIMI O CARACTER EM DL
MOV AH, 02H             ;PREPARA FUNÇÃO INT 21H IMPRIMIR CARACTER
MOV DL, BH              ;CONTEÚDO DE BH -> DL
INT 21H                 ;IMPRIMI O CARACTER EM DL
;MOV AX, 04H             
;INT 21H
RET                     ;RETORNA PARA ONDE FOI FEITO A CHAMADA DO PROCEDIMENTO 2 (SUBTRACAO) NA MAIN

POSITIVO:
    SUB BL, BH          ;BL = BL-BH
    MOV BH, 0           ;0 -> BH

OR BH, 30H              ;TRANSFORMA DECIMAL EM CARACTER
OR BL, 30H              ;TRANSFORMA DECIMAL EM CARACTER
MOV AH, 09H             ;FUNCÃO INT 21H IMPRIMIR STRING
LEA DX, msg4            ;FAZ O CONTEÚDO DE DX APONTAR PARA O ENDEREÇO DE ms4
INT 21H                 ;IMPRIMI A STRING msg4
MOV AH, 02H             ;PREPARA FUNÇÃO INT 21H IMPRIMIR CARACTER
MOV DL, BH              ;CONTEÚDO DE BH -> DL
INT 21H                 ;IMPRIMI O CARACTER EM DL
MOV AH, 02H             ;PREPARA FUNÇÃO INT 21H IMPRIMIR CARACTER
MOV DL, BL              ;CONTEÚDO DE BL -> DL
INT 21H                 ;IMPRIMI O CARACTER EM DL
NEXT1:
    RET                 ;RETORNA PARA ONDE FOI FEITO A CHAMADA DO PROCEDIMENTO 2 (SUBTRACAO) NA MAIN
SUBTRACAO endp          ;FINALIZAÇÃO DO PROCEDIMENTO 2 (SUBTRACAO)

MULTIPLICACAO PROC      ;PROCEDIMENTO 3 (MULTIPLICACAO)
                        ;RESPONSÁVEL EM MULTIPLICAR DOIS NÚMEROS
CMP CL,'*'              ;VERIFICAÇÃO DA OPERAÇÃO
JNE NEXT2               ;SE FOR IGUAL ELE REALIZA A MULTIPLICAÇÃO, SE NÃO FOR IGUAL ELE PULA PARA NEXT2

AND BL,0FH              ;TRANSFORMA CARACTER EM DECIMAL
AND BH,0FH              ;TRANSFORMA CARACTER EM DECIMAL

XCHG BH,BL              ; BH <=> BL (MULTIPLICADOR EM BL)
MOV CL,BH               ;CONTEÚDO DE BH -> CL 
XOR BH,BH               ;ZERANDO BH
MOV DX,CX               ;CONTEÚDO DE CX -> DX (MULTIPLICANDO EM DX)

XOR AX,AX               ;ZERANDO AX (PRODUTO)
XOR CX,CX               ;ZERANDO CX
MOV CX,8                ;INICIALIZANDO O CONTADOR

VOLTA:
    SHR BL, 1           ;REALIZA DESLOCAMNETO PARA DIREITA DOS BITS DE BL 1 VEZ
    JNC FINAL           ;SE A FLAG CARRY FOR 1 ELE CONTINUA, SE FOR 0 ELE PULA PARA FINAL
    ADD AX,DX           ;AX = AX+DX
    FINAL:
        SHL DX, 1       ;REALIZA DESLOCAMENTO PARA ESQUERDA DOS BITS DE DX 1 VEZ
        LOOP VOLTA      ;DECREMENTA 1 DE CX. SE CX FOR ZERO ELE CONTINUA SE > 0 ELE PULA PARA VOLTA

XCHG CX,AX              ; CX <=> AX
MOV AH, 09H             ;FUNCÃO INT 21H IMPRIMIR STRING
LEA DX, msg4            ;FAZ O CONTEÚDO DE DX APONTAR PARA O ENDEREÇO DE ms4
INT 21H                 ;IMPRIMI A STRING msg4
XCHG AX,CX              ; AX <=> CX (RETORNA O PRODUTO PARA AX)
MOV BL,10               ;10 -> BL
DIV BL                  ;DIVIDE O RESULTADO POR DEZ. PARA CONSEGUIR IMPRIMIR DOIS CARACTERES NO RESULTADO
MOV DL,AL               ;CONTEÚDO DE AL(quociente) -> DL
MOV DH,AH               ;CONTEÚDO DE AH(resto) -> DH
MOV AH, 02              ;PREPARA FUNÇÃO INT 21H IMPRIMIR CARACTER
OR  DL, 30H             ;TRANSFORMA DECIMAL EM CARACTER
INT 21h                 ;IMPRIMI O CARACTER EM DL
MOV DL, DH              ;CONTEÚDO DE DH(resto) -> DL
OR DL,30H               ;TRANSFORMA DECIMAL EM CARACTER
INT 21H                 ;IMPRIMI O CARACTER EM DL
NEXT2:
    RET                 ;RETORNA PARA ONDE FOI FEITO A CHAMADA DO PROCEDIMENTO 2 (SUBTRACAO) NA MAIN

MULTIPLICACAO endp

DIVISAO PROC            ;PROCEDIMENTO 4 (DIVISAO)
                        ;RESPONSÁVEL EM REALIZAR A DIVISÃO DE DOIS NÚMEROS
CMP CL,'/'              ;VERIFICAÇÃO DA OPERAÇÃO
JNE NEXT3               ;SE FOR IGUAL ELE REALIZA A DIVISÃO, SE NÃO FOR IGUAL ELE PULA PARA NEXT3

XOR AX,AX               ;ZERANDO AX (DIVIDENDO)
AND BL,0FH              ;TRANSFORMA CARACTER EM DECIMAL
MOV AL,BL               ;CONTEÚDO DE BL -> AL
AND BH,0FH              ;TRANSFORMA CARACTER EM DECIMAL (DIVISOR EM BH)
XOR BL,BL               ;ZERANDO BL
XOR DL,DL               ;ZERANDO DL (QUOCIENTE EM DL)
MOV CX,9                ;INICIALIZANDO O CONTADOR


DIVI: 

      SUB AX,BX         ;AX = AX-BX (IDENTIFICA SE O DIVIDENDO É MENOR OU MAIOR QUE O DIVISOR)
      JGE PULA          ;SE AX FOR MAIOR OU IGUAL A BX ELE SALTA PARA PULA, SE FOR MENOR ELE CONTINUA
      ADD AX,BX         ;
      MOV DH,0
      JMP PULA1
PULA:
      MOV DH,1      ;quociente
PULA1:
      SHL DL,1
      OR DL,DH 
      SHR BX,1
      LOOP  DIVI

CMP AL,0
JNE RESTO 

OR DL,30h
OR AL,30H
MOV CL,DL
MOV CH,AL

MOV AH, 09H
LEA DX, msg4
INT 21H

MOV AH,02 
MOV DL,CH
INT 21H

MOV AH,02 
MOV DL,CL
INT 21H
JMP NEXT3

RESTO: 
    OR DL,30h
    OR AL,30H
    MOV CL,DL
    MOV CH,AL

    MOV AH, 09H
    LEA DX, msg4
    INT 21H

    MOV AH,02 
    MOV DL,CL
    INT 21H

    MOV AH, 09H
    LEA DX, msg5
    INT 21H

    MOV AH,02 
    MOV DL,CH
    INT 21H

NEXT3: 
    RET

DIVISAO endp
END MAIN
